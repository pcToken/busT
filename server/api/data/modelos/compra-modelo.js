var mongoose = require("mongoose");
var autoIncrement = require("mongoose-auto-increment");
var enums = require("../enums.js")
var compraSchema = new mongoose.Schema({
    nro:{
        type:Number,
        required:true
    },
    empresa:{
        type:String,
        required:true
    },
    fecha:{
        type:Date,
        required:true
    },
    idProveedor :{
        type: mongoose.Schema.Types.ObjectId,
        ref:"Proveedor"
    },
    importeSindescuento:{
        required:true,
        type:Number
    },
    descuentos:[{
        importe:Number,
        concepto:String
    }],
    importe:{
        type:Number,
        required:true
    },
    moneda:{
        type:String,
        enum:enums.monedaEnum
    },
    saldoPago:{
        type:Number,
        required:true
    },
    estadoPago:{
        type:String
    },
    pagos:[{
        fecha:Date,
        importe:{
            required:true,
            type:Number
        },
        moneda:{
            type:Number,
            enum:enums.monedaEnum,
            required:true
        },
        saldo:{
            type:Number,
            required:true
        },
        nota:{
            nro:Number,
            foto:{
                descripcion:String,
                foto:String
            }
        },
        factura:{
            nro:Number,
            nit:String,
            fecha:Date,
            codigoControl:String,
            importe:Number,
            moneda:{
                type:Number,
                enum:enums.monedaEnum
            },
            foto:{
                descripcion:String,
                foto:String
            }
        }
    }],
    pedidos:[{
        idArticulo:{
            type:mongoose.Schema.Types.ObjectId,
            ref:"Articulo",
            required:true
        },
        idArticuloProveedor:String,
        cantidad:{
            type:Number,
            required:true
        },
        precioUnitario:{
            type:Number,
            required:true
        },
        importeSindescuento:{
            type:Number,
            required:true
        },
        descuentos:[{
            importe:Number,
            concepto:String
        }],
        importe:{
            type:Number,
            required:true
        },
        moneda:{
            type:String,
            required:true,
            enum:enums.monedaEnum
        }
    }],
    detalle:{
        usuarioCompra:{
            type:mongoose.Schema.Types.ObjectId,
            ref:"Empleado"
        },
        proveedorUsuario:{
            type:mongoose.Schema.Types.ObjectId,
            ref:"Proveedor.contactos"
        }
    }
});
compraSchema.plugin(autoIncrement,{model:"Compra",startAt:1,field:"nro"});
mongoose.model("Compra",compraSchema);